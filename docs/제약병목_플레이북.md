# 제약/병목 플레이북

> 5개 제약 도메인의 신호, 임계값, 근본 원인 분석, SCM 운영 병목 감지를 위한 조치 계획.

---

## 5개 제약 도메인

### 1. 공급 (Supply)
| 신호 | 임계값 | 심각도 | 근본 원인 | 조치 |
|--------|-----------|----------|------------|--------|
| late_po_ratio | >= 0.2 | HIGH/CRITICAL | 공급업체 납기 미달 | 구매팀 에스컬레이션; 대체 업체 평가 |
| supplier_delay_days | >= 7일 | HIGH/CRITICAL | 생산 지연 | 긴급 배송 협상; 안전 재고 증가 |

### 2. 창고 / 3PL
| 신호 | 임계값 | 심각도 | 근본 원인 | 조치 |
|--------|-----------|----------|------------|--------|
| backlog_ship_orders | >= 200 | HIGH/CRITICAL | 처리 용량 초과 | 임시 인력 추가; SLA 기준 우선순위 지정 |
| pick_pack_throughput_ratio | < 0.8 | HIGH | 처리량이 수요에 미달 | 프로세스 최적화; 설비 투자 |

### 3. 물류 / 통관
| 신호 | 임계값 | 심각도 | 근본 원인 | 조치 |
|--------|-----------|----------|------------|--------|
| dwell_time_days | >= 5 | HIGH | 통관 지연 | 사전 통관 서류 준비; 관세사 연계 |
| carrier_on_time_rate | < 0.9 | HIGH | 운송사 성과 미달 | 운송사 성과 검토; SLA 강화 |

### 4. 수요 / 채널
| 신호 | 임계값 | 심각도 | 근본 원인 | 조치 |
|--------|-----------|----------|------------|--------|
| return_rate_spike | >= 기준선 1.5배 | HIGH | 품질 또는 이행 오류 | 근본 원인 분석; 품질 감사 |
| promo_lift_ratio | >= 2.0배 | HIGH | 프로모션 수요가 용량 초과 | 용량 계획; 사전 재고 배치 |

### 5. 재무
| 신호 | 임계값 | 심각도 | 근본 원인 | 조치 |
|--------|-----------|----------|------------|--------|
| expired_value_at_risk | > 0 | CRITICAL | 유통기한 경과 재고 | 할인/기부 계획; 재발주 조정 |
| overstock_value | > DOH 임계값 | HIGH | 과잉 재고 | 수요 검토; 저회전 상품 처분 |

---

## 신호 흐름

1. **감지**: CORE/MART 데이터에서 지표 산출, 임계값과 비교
2. **신호**: `mart.mart_constraint_signals`에 기록
3. **CRITICAL → 자동 이슈**: 자동으로 `ops.ops_issue_log` 항목 생성
4. **근본 원인**: `mart.mart_constraint_root_cause`에서 규칙 기반 분석
5. **조치 계획**: `mart.mart_constraint_action_plan`에 권장 조치
6. **효과 추적**: `mart.mart_constraint_effectiveness`에서 전후 비교

---

## 재무 지표 보강 (v2025.06)

최근 업데이트로 재무 도메인에 금액 기반 KPI가 추가되었습니다:

| 신호 | 마트 테이블 | 산출 방식 | 비고 |
|---|---|---|---|
| `expired_value_at_risk` | `mart.mart_expiry_risk` | `onhand_qty × unit_cost_krw` (as-of join) | 원가 누락 시 NULL (0 채우기 금지) |
| `overstock_value` | `mart.mart_overstock` + cost join | `overstock_qty × unit_cost_krw` | 대시보드 실시간 산출 |
| `inventory_value` | `mart.mart_inventory_onhand` + cost join | `onhand_qty × unit_cost_krw` | 판매가능/차단/만료 각각 산출 |

### 대시보드 연동

- **SCM 대시보드 > 재고 현황 탭**: 재고금액, 판매가능/차단/만료 금액 표시
- **SCM 대시보드 > 과재고 탭**: 과재고 금액 TOP 10, 회전율 하위 10
- **SCM 대시보드 > 유통기한 탭**: 위험금액 합계, 버킷별 금액 분포
- **SCM 대시보드 > 제약/병목 탭**: 근본원인 분석 + 해소 효과 추적 (확장)
- **P&L 대시보드 > 영업이익 탭**: 영업이익 + coverage_flag 기반 이중 집계
- **P&L 대시보드 > 수익성 순위 탭**: TOP/BOTTOM 10 상품/채널

---

## 설정

모든 임계값은 `config/thresholds.yaml`의 `constraints` 섹션에 있습니다.
