# 데이터 입력 안내

> **대상:** 운영팀 실무자, 재무팀
> 파일을 언제, 어떻게 넣어야 하는지 설명합니다.

---

## 한눈에 보는 입력 일정

```
매일         →  주문 / 출고 / 재고 스냅샷
수시         →  발주 / 입고 / 반품 / 상품 정보
월말 마감 전  →  정산 인보이스 / 비용 / 환율 / 비용구조
```

> **핵심 원칙**: 없는 데이터는 안 넣어도 됩니다.
> 오늘 발주가 없으면 발주 파일 없어도 됩니다. 시스템이 있는 데이터만으로 분석합니다.

---

## 매일 넣는 데이터

> 이 3개만 매일 넣으면 재고현황, 품절위험, 서비스레벨 등 핵심 화면이 작동합니다.

| 데이터 | 파일명 예시 | 어디서 받나 |
|--------|-----------|-----------|
| **주문 내역** | `fact_order_20250115.csv` | 쇼핑몰 관리자, OMS |
| **출고 내역** | `fact_shipment_20250115.csv` | 물류센터, WMS |
| **재고 현황** | `fact_inventory_snapshot_20250115.csv` | 물류센터, WMS |

> 며칠치를 모아서 한번에 넣어도 됩니다. 금요일에 월~금 5일치를 한꺼번에 넣는 것도 OK.

---

## 이벤트가 있을 때 넣는 데이터

> 해당 이벤트가 발생했을 때만 넣으면 됩니다.

| 데이터 | 파일명 예시 | 언제 넣나 | 주로 누가 |
|--------|-----------|---------|---------|
| **구매발주** | `fact_po_20250115.csv` | 공급업체에 발주할 때 | 구매팀 |
| **입고 내역** | `fact_receipt_20250115.csv` | 물건이 창고에 도착할 때 | 물류센터 |
| **반품 내역** | `fact_return_20250115.csv` | 고객 반품 접수 시 | CS팀 |
| **상품 마스터** | `dim_item_20250115.xlsx` | 신상품 등록 또는 정보 변경 시 | 상품기획팀 |

---

## 월말 마감 전에 넣는 데이터

> 이 데이터들이 없으면 손익(P&L) 분석이 정확하지 않습니다. 월말 마감 전에 꼭 준비하세요.

| 데이터 | 파일명 예시 | 누가 주나 | 비고 |
|--------|-----------|---------|-----|
| **정산 인보이스** | `fact_settlement_202501.csv` | 3PL/운송사 | 청구서 받으면 바로 입력 |
| **배분된 비용** | `fact_charge_actual_202501.csv` | 재무팀 | 월별 물류비 집계 |
| **환율** | `fact_exchange_rate_202501.csv` | 재무팀 | 해당 월 사용 환율 |
| **비용 구조** | `fact_cost_structure_202501.csv` | 재무팀 | 품목별 단위원가 |

> 이 4개가 없어도 재고·주문·출고 분석은 정상 작동합니다.
> 단, **P&L 대시보드의 손익 수치가 불완전**하게 표시됩니다.

---

## 파일 이름 규칙

```
{데이터종류}_{날짜}.csv
예시: fact_order_20250115.csv
     fact_inventory_snapshot_20250115.xlsx
```

> **팁**: 파일 이름이 정확하지 않아도 됩니다.
> 시스템이 파일 내용(컬럼명)을 읽어서 자동으로 어떤 데이터인지 판단합니다.

> **팁**: 컬럼명이 한국어여도 됩니다.
> 예: `주문번호` → 자동으로 인식됩니다.

---

## 파일 넣는 방법 (단계별)

### 1단계: 파일 준비
- 쇼핑몰, 물류센터, 재무팀에서 파일을 받습니다
- CSV 또는 엑셀(XLSX) 형식 모두 가능합니다

### 2단계: inbox 폴더에 넣기
- 프로젝트 폴더 안에 있는 `inbox/` 폴더를 엽니다
- 파일을 드래그&드롭으로 넣습니다

```
프로젝트 폴더/
├── inbox/          ← 여기에 파일을 넣으세요
│   ├── fact_order_20250115.csv
│   └── fact_inventory_snapshot_20250115.xlsx
```

### 3단계: 실행
명령 프롬프트(터미널)에서 아래 명령어를 입력합니다:
```
python run.py --once
```

완료되면 이런 메시지가 나옵니다:
```
Pipeline completed successfully. 2 files, 800 rows
```

> "2 files" = 2개 파일 처리 완료
> "800 rows" = 800행 저장 완료

### 4단계: 대시보드 확인
- SCM 대시보드: 브라우저에서 `http://localhost:8501`
- P&L 대시보드: 브라우저에서 `http://localhost:8502`

---

## 오류가 났을 때

### "파일이 실패했다"는 메시지가 나온 경우

흔한 원인과 해결책:

| 증상 | 원인 | 해결 방법 |
|------|-----|---------|
| 필수 컬럼 누락 오류 | 파일에 필수 항목이 없음 | 컬럼명 확인 후 재업로드 |
| 빈 값 오류 | 주문번호 등 필수 항목에 빈 셀이 있음 | 빈 셀 채운 후 재업로드 |
| 중복 오류 | 같은 주문번호가 두 번 들어있음 | 중복 행 제거 후 재업로드 |
| 알 수 없는 비용 코드 | 새로운 비용 항목이 등록되지 않음 | 개발팀에 새 비용 코드 등록 요청 |

### "Pipeline is locked" 메시지가 나온 경우
이전 실행이 비정상 종료된 것입니다. 아래 명령어로 해제합니다:
```
python run.py --unlock
```

### 잘못된 파일을 넣었을 때
가장 최근 처리를 취소하려면:
```
python run.py --rollback 1
```

---

## 월별 운영 달력 예시

```
┌──────────────────────────────────────────────────────┐
│  매월 1~말일: 일상 운영                                 │
│  ├── 매일: 주문 + 출고 + 재고 파일 입력                  │
│  ├── 수시: 발주 / 입고 / 반품 (발생시)                   │
│  └── 언제든: 상품 마스터 변경 (신상품/정보수정)            │
│                                                      │
│  ★ 다음달 초 (예: 2월 1~5일): 1월 마감                  │
│  ├── 3PL/운송사에서 정산 인보이스 받기                    │
│  ├── 재무팀에서 비용·환율·비용구조 파일 받기               │
│  ├── inbox에 넣고 python run.py --once 실행            │
│  ├── 커버리지 100% 확인 (python run.py --status)       │
│  └── 담당자가 월 마감 실행                               │
└──────────────────────────────────────────────────────┘
```

> 월 마감 절차 상세 내용 → [04_월마감_단계별_안내.md](04_월마감_단계별_안내.md)

---

## 자주 묻는 질문

**Q. 같은 파일을 두 번 넣으면 어떻게 되나요?**
자동으로 중복을 감지하고, 최신 버전으로 업데이트됩니다. 중복 저장되지 않습니다.

**Q. 엑셀(XLSX)과 CSV 중 어떤 게 좋나요?**
둘 다 가능합니다. 파일 크기가 크면 CSV가 약간 빠르지만 차이는 미미합니다.

**Q. 파일을 며칠 안 넣으면 대시보드가 사라지나요?**
이전에 넣은 데이터는 그대로 유지됩니다. 나중에 빠진 날짜 데이터를 넣으면 자동으로 채워집니다.

**Q. 3PL에서 주는 파일의 컬럼명이 다른데요?**
개발팀에 3PL 컬럼명을 알려주면 자동 인식되도록 설정할 수 있습니다.
